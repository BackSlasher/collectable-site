<html>
   <head>
      <meta charset="UTF-8">
      <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
      <style type="text/css">
         .centered {
         text-align: center;
         }
         /* https://www.w3schools.com/Css/css_image_gallery.asp */
         #collection div.gallery {
         margin: 5px;
         /*border: 1px solid #ccc;*/
         float: left;
         border: 1px solid #ccc;
         }
         div.gallery img {
         width: 120px;
         height: auto;
         }
         div.desc {
         padding: 15px;
         text-align: center;
         }
      </style>
   </head>
   <body>
      <div class="centered">
         <div id="today">
            <div class="gallery">
               <img src="images/omelettes/Pizza Omelette.gif" />
               <div class="desc">
                 <div class="title">Pizza Omelette</div>
                 <div class="collect">Collect me!</div>
               </div>
            </div>
            <h1>Today's item</h1>
         </div>
         <hr/>
         <div id="collection">
            <h1>Gallery</h1>
            <div class="gallery">
               <img src="images/omelettes/Bacon and Broccoli Omelette.gif" />
               <div class="desc">
                  Bacon and Broccoli Omelette</br>
                  Collected on: 2022-11-04
               </div>
            </div>
            <div class="gallery">
               <img src="images/omelettes/Fresh Fruit Surprise Omelette.gif" />
               <div class="desc">
                  Fresh Fruit Surprise Omelette</br>
                  Collected on: 2022-11-03
               </div>
            </div>
            <div class="gallery">
               <img src="images/omelettes/Little Fishy Omelette.gif" />
               <div class="desc">
                  Little Fishy Omelette</br>
                  Collected on: 2022-11-02
               </div>
            </div>
         </div>
      </div>
      <script src="https://code.jquery.com/jquery-3.6.1.slim.min.js"></script>
      <script type="text/javascript">
        function weightedRandom(items) {
          const arrDeep = items.map(item => 
            [...Array(item.rarity).keys()].map(n => item)
          );
          const arrFlat = [].concat(...arrDeep);
          const element = arrFlat[Math.floor(Math.random() * arrFlat.length)];
          return element;
        }

        async function todaysProdudct() {
          const dat = await fetch('data/omelettes.json');
          const j = await dat.json();
          const modJ = j.map(i => {
            const imageSplit = i[1].split(".");
            const imageExtension = "."+imageSplit[imageSplit.length-1];
            return ({
              name: i[0],
              image: ("images/omelettes/"+i[0]+imageExtension),
              rarity: i[2],
            })
          });
          const product = weightedRandom(modJ);
          console.log("aaaaa", product);
          
          // Update stuff
          $("#today img").attr("src",product.image);
          $("#today .title").text(product.name);

        }
        function main() {
          (async () => {await todaysProdudct();})();
        }
        main();
      </script>
   </body>
</html>

